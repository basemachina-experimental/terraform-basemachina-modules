# 実装計画

## 概要

このドキュメント更新プロジェクトは、BaseMachina Terraform Modulesプロジェクトの全READMEファイルを、現在の実装に合わせて正確かつ包括的に更新します。段階的に各READMEを更新し、各フェーズで検証を行います。

## タスク

- [x] 1. 変数とオプションの調査・分析
  - modules/aws/ecs-fargate/variables.tfを読み込み、すべての入力変数をリストアップ
  - examples/aws-ecs-fargate/*.tfファイルを読み込み、使用されている変数を確認
  - test/aws/ecs_fargate_test.goを読み込み、使用されている環境変数を確認
  - 現在のREADMEファイルとの差異を特定し、更新が必要な箇所をリストアップ
  - _Requirements: 1.1, 2.1, 3.1_

- [x] 2. モジュールREADMEの更新
- [x] 2.1 入力変数セクションの更新
  - variables.tfに定義されているすべての変数を正確に記載
  - 変数の型、デフォルト値、説明をvariables.tfと一致させる
  - 必須変数とオプション変数を明確に区別
  - _Requirements: 1.1_

- [x] 2.2 使用例セクションの更新
  - 必須変数を含む完全な使用例を提供
  - certificate_arn（必須）を含める
  - domain_nameとroute53_zone_id（Route53統合用、必須）を含める
  - その他のネットワーク関連変数を含める
  - HCL構文が正しいことを確認
  - _Requirements: 1.2_

- [x] 2.3 ドメイン設定セクションの追加
  - Route53 Hosted Zoneとの統合方法を説明
  - domain_nameとroute53_zone_id変数の役割を説明
  - Hosted Zone IDの確認方法を説明
  - _Requirements: 1.3_

- [x] 2.4 証明書オプションセクションの更新
  - DNS検証によるACM証明書自動発行（推奨）の説明を追加
  - 自己署名証明書のACMインポートの説明を追加
  - 既存のACM証明書の利用の説明を追加
  - HTTPのみの構成（非推奨）の説明を追加
  - 各オプションの設定方法を明確に説明
  - _Requirements: 1.4_

- [x] 2.5 ネットワーク要件セクションの更新
  - NAT Gatewayの役割と必須性を説明（Public ECRアクセス用）
  - VPCエンドポイントの役割と設定を説明（Private ECR、S3、CloudWatch Logs用）
  - ECRプルスルーキャッシュの仕組みと利点を説明
  - デフォルト構成（VPCエンドポイント + NAT Gateway）を推奨として説明
  - _Requirements: 1.5_

- [x] 2.6 モジュールREADMEの検証
  - variables.tfとの完全な一致を確認
  - 使用例が動作することを確認（HCL構文チェック）
  - 必須変数がすべて含まれていることを確認
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 3. ExampleREADMEの更新
- [x] 3.1 前提条件セクションの更新
  - VPCとサブネット（パブリック・プライベート）の必要性を説明
  - Route53 Hosted Zone（DNS検証を使用する場合、必須）の必要性を追加
  - BaseMachinaテナントIDの必要性を説明
  - AWS認証情報の必要性を説明
  - Hosted Zoneの作成方法を説明（コマンド例を含む）
  - _Requirements: 2.1_

- [x] 3.2 デプロイ手順セクションの更新
  - terraform.tfvarsの設定手順を更新（bridge_domain_nameとroute53_zone_idを含む）
  - terraform init、plan、applyの実行手順を確認
  - DNS検証待機時間（5-15分）の説明を追加
  - デプロイ後の確認方法を説明
  - デプロイ完了時の出力例を提供
  - _Requirements: 2.2_

- [x] 3.3 証明書設定セクションの更新
  - DNS検証による自動発行の設定方法を説明（bridge_domain_nameとroute53_zone_idの設定）
  - 自己署名証明書の設定方法を説明（enable_acm_import = trueの設定）
  - 既存のACM証明書の設定方法を説明（certificate_arnの設定）
  - 各オプションの利点と欠点を説明
  - 推奨オプション（DNS検証）を明確に示す
  - _Requirements: 2.3_

- [x] 3.4 RDS統合セクションの追加（オプション）
  - RDS variables（database_username、database_passwordなど）の設定方法を説明
  - Bastion hostの使用方法を説明
  - RDSへのSSHトンネル経由でのアクセス方法を説明
  - _Requirements: 2.4_

- [x] 3.5 トラブルシューティングセクションの更新
  - ACM証明書のDNS検証が完了しない場合の対処法を追加
  - diagnose-dns-validation.shスクリプトの使用方法を説明
  - よくある原因（Zone IDの間違い、DNS伝播待ち、権限不足）を説明
  - ECSタスクが起動しない場合の対処法を更新
  - ALBヘルスチェックが失敗する場合の対処法を追加
  - _Requirements: 2.5_

- [x] 3.6 ExampleREADMEの検証
  - モジュールREADMEとの一貫性を確認
  - デプロイ手順の正確性を確認
  - トラブルシューティングガイドの有用性を確認
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 4. テストREADMEの検証と更新
- [x] 4.1 環境変数セクションの検証
  - TEST_VPC_ID、TEST_PRIVATE_SUBNET_IDS、TEST_PUBLIC_SUBNET_IDS（必須）が正確に記載されているか確認
  - TEST_TENANT_ID（必須）が正確に記載されているか確認
  - TEST_BRIDGE_DOMAIN_NAME、TEST_ROUTE53_ZONE_ID（DNS検証オプション）が正確に記載されているか確認
  - TEST_ENABLE_ACM_IMPORT（自己署名証明書オプション）が正確に記載されているか確認
  - TEST_CERTIFICATE_ARN（既存証明書オプション）が正確に記載されているか確認
  - テストコード（ecs_fargate_test.go）との一致を確認
  - 必要に応じて環境変数の説明を更新
  - _Requirements: 3.1_

- [x] 4.2 テスト実行コマンドセクションの検証
  - 正しいタイムアウト値（60m）が含まれているか確認
  - コマンド例が動作することを確認
  - 必要に応じてコマンド例を更新
  - _Requirements: 3.2_

- [x] 4.3 実行時間セクションの検証
  - DNS検証を使用する場合の所要時間（15-20分）が記載されているか確認
  - 自己署名証明書または証明書なしの場合の所要時間（10-15分）が記載されているか確認
  - ACM証明書のDNS検証タイムアウト（15分）が記載されているか確認
  - 必要に応じて実行時間の説明を更新
  - _Requirements: 3.3_

- [x] 4.4 トラブルシューティングセクションの検証
  - ACM証明書のDNS検証問題の診断方法が記載されているか確認
  - diagnose-dns-validation.shスクリプトの使用方法が説明されているか確認
  - よくある原因が網羅されているか確認
  - 必要に応じてトラブルシューティングガイドを更新
  - _Requirements: 3.4_

- [x] 4.5 テスト内容セクションの検証
  - Route53 Hosted Zoneの存在確認（DNS検証使用時）が記載されているか確認
  - ACM証明書のDNS検証（最大15分タイムアウト）が記載されているか確認
  - ECSタスクの起動確認が記載されているか確認
  - ALBヘルスチェックが記載されているか確認
  - HTTPS エンドポイントの疎通確認が記載されているか確認
  - 必要に応じてテスト内容の説明を更新
  - _Requirements: 3.5_

- [x] 4.6 テストREADMEの最終検証
  - テストコードとの一致を確認
  - コマンド例が動作することを確認
  - タイムアウト値が適切であることを確認
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 5. ルートREADMEの更新
- [x] 5.1 プロジェクト概要セクションの確認
  - プロジェクトの目的が明確に説明されているか確認
  - 主要なユースケースが記載されているか確認
  - 必要に応じて概要を更新
  - _Requirements: 4.1_

- [x] 5.2 主要機能セクションの更新
  - Route53統合によるDNS管理を追加
  - DNS検証によるACM証明書の自動発行を追加
  - 複数の証明書オプション（DNS検証、自己署名、既存証明書、HTTP）を追加
  - VPCエンドポイント + NAT Gatewayのハイブリッド構成を追加
  - Terratestによる包括的な統合テストを追加
  - 既存の機能リストを最新の実装に合わせて更新
  - _Requirements: 4.2_

- [x] 5.3 クイックスタートセクションの更新
  - examples/aws-ecs-fargateへの明確なリンクを追加
  - 基本的なステップを簡潔に説明
  - 必要に応じてクイックスタートの手順を更新
  - _Requirements: 4.3_

- [x] 5.4 ディレクトリ構造セクションの追加（オプション）
  - modules/、examples/、test/ディレクトリの役割を説明
  - 各ディレクトリの内容を簡潔に説明
  - _Requirements: 4.4_

- [x] 5.5 ルートREADMEの検証
  - モジュールREADMEとExampleREADMEとの一貫性を確認
  - 主要機能が最新の実装を反映していることを確認
  - リンクが正しく機能することを確認
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [x] 6. ドキュメント間の一貫性チェック
- [x] 6.1 変数名と説明の一貫性チェック
  - 全READMEファイルで同じ変数を参照する場合、変数名と説明が一致しているか確認
  - 不一致がある場合、正しい変数名と説明に統一
  - _Requirements: 5.1_

- [x] 6.2 証明書オプションの用語統一
  - 全READMEファイルで証明書オプションを説明する場合、一貫した用語を使用しているか確認
  - 「DNS検証」「自己署名証明書」「既存証明書」「HTTP」の用語で統一
  - _Requirements: 5.2_

- [x] 6.3 ネットワーク構成の説明統一
  - 全READMEファイルでネットワーク構成を説明する場合、NAT Gateway、VPCエンドポイント、ECRプルスルーキャッシュの役割について一貫した説明を提供しているか確認
  - 不一致がある場合、統一した説明に修正
  - _Requirements: 5.3_

- [x] 6.4 コマンド例のフォーマット統一
  - 全READMEファイルでコマンド例を参照する場合、同じフォーマットとオプションを使用しているか確認
  - Bashコードブロックのフォーマットを統一
  - _Requirements: 5.4_

- [x] 6.5 クロスリファレンスリンクの検証
  - 全READMEファイル内のリンクが正しく機能するか確認
  - 相対パスリンクが正しいか確認
  - 外部リンク（AWS公式ドキュメント等）が有効か確認
  - リンク切れがある場合、修正
  - _Requirements: ドキュメント間の一貫性_

- [x] 6.6 最終的な一貫性確認
  - すべてのドキュメント間で用語が統一されていることを確認
  - リンクがすべて正しく機能することを確認
  - 説明に矛盾がないことを確認
  - 一貫性の問題が発見された場合、修正
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [x] 7. 変更履歴とバージョン情報の追加（オプション）
- [x] 7.1 変更履歴セクションの追加
  - 最近の主要な変更（Route53統合、DNS検証、テスト強化など）を記載
  - 変更日と変更内容を記載
  - 必要に応じて各READMEに変更履歴セクションを追加
  - _Requirements: 6.1_
  - **判断**: オプションとしてスキップ（ドキュメント更新は実装変更ではないため）

- [x] 7.2 バージョン情報の追加
  - モジュールがバージョン管理されている場合、推奨バージョンを記載
  - 互換性情報を提供
  - 必要に応じてバージョン情報セクションを追加
  - _Requirements: 6.2_
  - **判断**: オプションとしてスキップ（モジュールはまだバージョン管理されていない）

## 実装の注意事項

- 各タスクは順次実行し、フェーズごとに検証を行う
- 問題が発見された場合、Git revertで安全にロールバックする
- すべてのドキュメント更新は、既存の構造を尊重し、内容のみを更新する
- 実装コードの変更は行わない（ドキュメントのみを更新）
